{# templates/enseignant/listEnseignants.html.twig #}

{% extends 'base.html.twig' %}

{% block title %}Liste des Enseignants{% endblock %}

{% block body %}
    <h1>Liste des Enseignants</h1>

    {# Search form with input and button, add here if needed #}
    

    {# Table to display Enseignants details #}
    <table id="enseignantsTable" class="table">
        <!-- Table header -->
        <thead>
            <tr>
                <th>ID</th>
                <th>Pr√©nom</th>
                <th>Nom</th>
                <th>Email</th>
                <th>Etablissement</th>
                <th>Actions</th>
            </tr>
        </thead>
        <!-- Table body will be populated using JavaScript -->
        <tbody id="enseignantsTableBody"></tbody>
    </table>

    {# Add link to add new Enseignant #}
    <a href="{{ path('enseignant_add') }}">Ajouter</a>

    <script>
        // Function to initialize the table with values
        function initializeTable() {
            // Use DataTables to initialize the table
            $('#enseignantsTable').DataTable({
                // Your DataTables configuration options go here
            });

            // Fetch and update data for the initial table
            fetchDataAndUpdateTable();
        }

        // Function to perform search
        function performSearch() {
            // Trigger DataTables search
            $('#enseignantsTable').DataTable().search($('#search').val()).draw();
        }

        // Function to fetch and update data for the table
        function fetchDataAndUpdateTable() {
            // Use AJAX to fetch data for the initial table
            $.ajax({
                url: '{{ path('enseignant_list') }}',
                method: 'GET',
                success: function(response) {
                    // Update the DataTable with the fetched data
                    updateTable(response.enseignants);
                },
                error: function() {
                    // Handle errors
                    console.error('Initial data request failed');
                }
            });
        }

        // Function to update the table
        function updateTable(enseignants) {
            // Get the DataTable instance
            const dataTable = $('#enseignantsTable').DataTable();

            // Clear existing rows
            dataTable.clear();

            // Iterate over the data and add rows to the table
            enseignants.forEach(function (enseignant) {
                dataTable.row.add([
                    enseignant.id,
                    enseignant.firstName,
                    enseignant.lastName,
                    enseignant.email,
                    enseignant.etablissement.name, // Assuming there is a 'name' property in the Etablissement entity
                    `<a href="/enseignant_delete/${enseignant.id}">Supprimer</a>
                    <a href="/enseignant_edit/${enseignant.id}">Modifier</a>`
                ]).draw();
            });
        }

        // Call initialization function when the page loads
        $(document).ready(initializeTable);
    </script>
{% endblock %}
